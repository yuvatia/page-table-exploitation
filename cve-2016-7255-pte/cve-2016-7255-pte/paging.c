#include "paging.h"

unsigned long long GetPteAddress(unsigned long long addr) {
	addr >>= 9;
	addr &= 0x7FFFFFFFF8;
	addr += PTE_BASE;
	return addr;
}

unsigned long long GetPdeAddress(unsigned long long address) {
	address >>= 18;
	address &= 0x3FFFFFF8;
	address += PDE_BASE;
	return address;
}

unsigned long long GetPpeAddress(unsigned long long address) {
	address >>= 27;
	address &= 0x1FFFF8;
	address += PPE_BASE;
	return address;
}

unsigned long long GetPxeAddress(unsigned long long address) {
	address >>= 36;
	address &= 0xFF8;
	address += PXE_BASE;
	return address;
}

unsigned long long useAsPte(unsigned long long pxeAddress) {
	unsigned long long index = (pxeAddress & 0xFFF) / 8;
	unsigned long long result = (
		((unsigned long long)0xFFFF << 48) |
		((unsigned long long)PXE_SELFMAP_INDEX << 39) |
		((unsigned long long)PXE_SELFMAP_INDEX << 30) |
		((unsigned long long)PXE_SELFMAP_INDEX << 21) |
		(index << 12)
		);
	return result;
}
